<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Tutoring - Learn South Sudan</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="student-dashboard.html">
                    <img src="logo..png" alt="SSPLP Logo" class="logo">
                    <span>SSPLP</span>
                </a>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="student-dashboard.html" class="nav-link">Home</a>
                <a href="subjects.html" class="nav-link">Subjects</a>
                <a href="quizzes.html" class="nav-link">Quizzes</a>
                <a href="tutoring.html" class="nav-link active">Tutoring</a>
                <a href="messaging.html" class="nav-link">Messages</a>
                <a href="progress.html" class="nav-link">Progress</a>
            </div>
            <button id="logoutBtn" class="btn-signin">Logout</button>
            <button class="nav-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <section class="tutoring">
        <div class="container">
            <h1>Online Tutoring</h1>
            <p>Get help from teachers when you need it</p>
            
            <div id="videoSection" style="display:none;">
                <div class="video-container" id="videoContainer">
                    <video id="localVideo" autoplay muted></video>
                    <video id="remoteVideo" autoplay></video>
                </div>
                <div id="videoControls"></div>
            </div>
            
            <div class="tutoring-content" id="tutoringContent">
                <div class="teachers-section">
                    <h2>Teachers</h2>
                    <div class="teachers-grid" id="teachersGrid">
                        <!-- Teachers will be loaded here -->
                    </div>
                </div>
                
                <div class="sessions-section">
                    <h2>Your Scheduled Sessions</h2>
                    <p style="color: #6b7280; margin-bottom: 15px;">Sessions scheduled by your teachers will appear here</p>
                    <div class="sessions-list" id="sessionsList">
                        <!-- Sessions will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="js/app.js"></script>
    <script src="js/message-notification.js"></script>
    <script src="js/video-conferencing.js"></script>
    <script src="js/notifications.js"></script>
    <script>
        // Load teachers
        function loadTeachers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const teachers = users.filter(u => u.role === 'teacher');
            
            document.getElementById('teachersGrid').innerHTML = teachers.length ? teachers.map(t => `
                <div class="teacher-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px;">
                    <h3>${t.name}</h3>
                    <p style="color: #6b7280; margin: 5px 0;"><strong>Subjects:</strong> ${(t.subjects || []).join(', ') || 'Not assigned'}</p>
                    <p style="color: #6b7280; margin: 5px 0;"><i class="fas fa-envelope"></i> ${t.email}</p>
                </div>
            `).join('') : '<p>No teachers available</p>';
        }

        // Load only teacher-scheduled sessions
        function loadSessions() {
            const student = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const bookings = JSON.parse(localStorage.getItem('bookings') || '[]')
                .filter(b => b.studentId === student.id && new Date(b.datetime) > new Date())
                .sort((a, b) => new Date(a.datetime) - new Date(b.datetime));
            
            document.getElementById('sessionsList').innerHTML = bookings.length ? bookings.map(s => `
                <div class="session-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h3 style="margin: 0 0 5px 0;">${s.title || s.type + ' Session'}</h3>
                            <p style="color: #6b7280; margin: 5px 0;"><i class="fas fa-user"></i> ${s.teacherName}</p>
                            <p style="color: #6b7280; margin: 5px 0;"><i class="fas fa-book"></i> ${s.subject || 'General'}</p>
                            <p style="color: #6b7280; margin: 5px 0;"><i class="fas fa-clock"></i> ${new Date(s.datetime).toLocaleString()}</p>
                            ${s.description ? `<p style="margin: 10px 0 0 0;">${s.description}</p>` : ''}
                        </div>
                        <a href="${s.meetLink}" target="_blank" class="btn btn-primary" style="white-space: nowrap;">
                            <i class="fas fa-video"></i> Join
                        </a>
                    </div>
                </div>
            `).join('') : '<p>No sessions scheduled yet. Your teacher will schedule sessions for you.</p>';
        }

        function joinSession(sessionId) {
            document.getElementById('tutoringContent').style.display = 'none';
            document.getElementById('videoSection').style.display = 'block';
            videoConferencing.startSession('room-' + sessionId);
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadTeachers();
            loadSessions();
        });
    </script>
</body>
</html>